# Deploy the project on GCP. Cloud Run the basis for your services.

## Архітектура WEB проекту

В кожному проекті є своя архіектура, вона проектується заздалегідь на початковій стадії (що є правильно),
або ж корегується в стадії активної розробки. В будь-якому випадку вашому проекту потрібна веб архітекта з сервісами 
які її обслуговують. І от перед створення цієї архітектури виникає питання, яка платформа буде слугувати основою для 
нашої архітектури ?. Нам би хотілося щоб у нас була можливість розвернути наш проект із всіма його сервісами і бажнано
щоб ці сервіси знаходились на одній платформі. 

Тому почнемо ми цю статтю з GCP. Та розглянемо основні хмарні служби які нам потрібні будуть для розгортання нашого
тестового проекту. За основу для нашого проекту ми візьмемо платформу для спікерів та їхніх підписників https://my-talks.net/ .


 ## Проект та його сервіси

[My-talks](https://my-talks.net/) це портфоліо для спікера, хаб цікавих докладів для користувачів, і не забули вньому про 
організаторів з їхніми Call For Papers. Для старту нашого тестового проекту нам потрібно буде розвернути такі сервіси:
 - beckend (Cloud Run)
 - frontend (Cloud Run)
 - storage for data (Cloud Storage)
 - database (Google Cloud SQL)

 Джерелом коду для нашого тестового проекту є два відкритих репозитарія :
 - https://github.com/yaroslav-lototskyi/cloud-run-backend-example
 - https://github.com/yaroslav-lototskyi/cloud-run-frontend-example


 ## Cloud Run the basis for your services

 Як ми бачимо основні наші сервіси будуть розгорнуті на платформі Cloud Run.
 Cloud Run це продукт GCP, який дає змогу без проблем створювати, налагоджувати та розгортати ваші сервіси 
 за допомогою serverless computing model. Cloud Run services дає нам змогу розгортати наші сервіси у вигляді контейнерів
 та включає в себе всі плюси serverless computing. Поміж них хочеться відзначити такі як :
- Підтримка будь-якої мови програмування та операційної системи за допомогою технології контейнеризації
- Автоматичне масштабування на основі запитів. Кожен сервіс Cloud Run має унікальну кінцеву точку https і наші контейнери
автоматично горизонтально мастабуються залешно від запитів та навантаження на контейнер, налаштування якого ви ми жете змінити 
в будь-який момент
- Керування трафіком. Під час кожного розгортання сервісу створюється нова ревізія, до якої ви завжди можете повернутися
перенаправивши трафік повністю або частково

У Cloud Run є чудовий плюс у вигляді якісних інтеграцій. У Google Cloud дуже розвинена екосистема в різних технологічних напрямках.
[My-talks](https://my-talks.net/) використовує безліч корисних інтеграцій, але ось деякі які ми використаємо у 
нашому тестовому проекті для спікерів:
- Secret Manager (Store API keys, passwords, certificates, and other sensitive data)
- Continuous delivery (Cloud Build. Configure Cloud Run to automatically deploy new commits)
- Data storage (Cloud Storage, Cloud SQL)


## Розгорнемо наш проект на GCP

Хто ще не мав досвіду з даною платформою - для початку нам потрібно зареєструватися на платормі та створити проект. Потім створимо 
сховище для данних та налаштуємо базу данних.
І завершальним етапом буде створення сервісів у Cloud Run, де ми отримаємо посилання на наш мервіс frontend і зможемо 
фізично скористатися нашим додатком.

### Реєстрація на GCP та створення проекту

Для реєстрації у безкоштовній пробній версії перейдіть за посиланням https://console.cloud.google.com/freetrial/signup/tos та виконайте всі для цього кроки,
включаючи підтвердження платіжної інформації. Після успішного заповнення всіх облікових данних, автоматично створюється новий проект, у нашому випадку
він має назву - 'My First Project'. Також для роботи з Cloud Run та його інтеграціями потрібно включити Compute Engine API, це можна зробити за посиланням https://console.cloud.google.com/marketplace/product/google/compute.googleapis.com

### Створюємо bucket для нашого сховища (в данному випадку для картинок)

Переходимо за посиланням https://console.cloud.google.com/storage/browser та створюємо bucket, який ми потім будемо використовувати 
в нашому backend сервісі , а саме для збереження картинок. Cloud storage підтримує технологію S3, якою ми будемо користуватися. Тому це зручно тому хто
хоче переїхати з інших S3-подібних сервісів на Cloud storage.
<p align="center">
    <img alt='create bucket' src="./images/createBucket.png" width="50%" >
</p>

Потрібно буде заповнити наступні дані:
- Name your bucket (назвемо наш bucket cloud-run-backend-example)
- Choose where to store your data (виберіть регіон для сховища)
- В тих кроках які пропустили залишаємо значення за умовчанням та натискаємо кнопку CREATE BUCKET

### Створюємо екземпляр бази даних SQL

Переходимо за посилання https://console.cloud.google.com/sql/instances та створюємо базу даних, до якої ми потім підєднаємось із нашого
beckend сервісу, в базі у нас для прикладу буде тільки одна таблиця з докладами спікера. Сам доклад ми потім створимо в нашому готовому веб-додатку.
<p align="center">
    <img alt='create db instance' src="./images/createDBInstance.png" width="50%" >
</p>

Механізм бази даних вибираємо MySQL
Потім потрібно буде заповнити наступні дані:
- Поле Instance ID (назвемо наш instance cloud-run-backend-example-db)
- Поле Password (скористаємось автоматичною генерацією пароля та збережемо його для майбутніх налаштувань)
- Поле Region (виберіть регіон для бази даних)
- Zonal availability (вибираємо Single zone)

На цій же сторінці нижче натискаємо кнопку SHOW CONFIGURATION OPTIONS
<p align="center">
    <img alt='create db instance' src="./images/showConfigurationDB.png" width="50%" >
</p>

Та продовжуємо налаштування:
- Розділ Machine type (вибираємо shared core)
- Розділ Storage (вибираємо обєм 10GB)
- В тих кроках які пропустили залишаємо значення за умовчанням та натискаємо кнопку CREATE INSTANCE, та потрібно буде зачекати декілька хвилин
    для створення екземпляра
